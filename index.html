<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>M√£ ho√° & Gi·∫£i m√£ + Tra c·ª©u App Store</title>
    <link rel="stylesheet" href="style.css" />
    <style>
        /* Style cho ph·∫ßn tra c·ª©u */
        #appLookupResult {
            margin-top: 20px;
            background: #f0f0f0;
            padding: 15px;
            border-radius: 5px;
            max-height: 400px;
            overflow-y: auto;
            font-family: Arial, sans-serif;
            font-size: 14px;
            line-height: 1.5;
            color: #333;
        }

        #appLookupResult p {
            margin: 8px 0;
        }

        #appLookupResult a {
            color: #007aff;
            text-decoration: none;
        }

        #appLookupResult a:hover {
            text-decoration: underline;
        }

        #showMoreBtn {
            display: inline-block;
            margin-top: 5px;
            color: #007aff;
            cursor: pointer;
            user-select: none;
            font-weight: bold;
        }

        /* Ph·∫ßn raw JSON */
        #rawDataContainer {
            margin-top: 30px;
        }

        #rawData {
            background: #222;
            color: #eee;
            padding: 15px;
            border-radius: 5px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', Courier, monospace;
            font-size: 13px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>M√£ ho√° & Gi·∫£i m√£</h1>

        <!-- Dropdown ch·ªçn ph∆∞∆°ng th·ª©c m√£ ho√°/gi·∫£i m√£ -->
        <select id="method">
            <option value="base64">Base64 Encoding/Decoding (m·∫∑c ƒë·ªãnh)</option>
            <option value="caesar">Caesar Cipher (+3/-3)</option>
            <option value="reverse">ƒê·∫£o ng∆∞·ª£c chu·ªói</option>
            <option value="reverse-chunk">Reverse Split Chunk</option>
            <option value="custom">ƒê·∫£o ng∆∞·ª£c chu·ªói v√† chia th√†nh c·∫∑p</option>
        </select>

        <!-- √î nh·∫≠p chu·ªói -->
        <input type="text" id="inputText" placeholder="Nh·∫≠p chu·ªói..." />

        <!-- C√°c n√∫t m√£ ho√°/gi·∫£i m√£ -->
        <div class="button-group">
            <button onclick="encodeText()">üîê M√£ ho√°</button>
            <button onclick="decodeText()">üîì Gi·∫£i m√£</button>
        </div>

        <!-- K·∫øt qu·∫£ ƒë·∫ßu ra -->
        <div id="outputText" class="output" title="Click ƒë·ªÉ copy k·∫øt qu·∫£"></div>

        <!-- Th√¥ng b√°o sao ch√©p -->
        <div id="copyMessage" class="copy-message">Copied!</div>

        <!-- PH·∫¶N M·ªöI: Tra c·ª©u App Store -->
        <hr />
        <h2>Tra c·ª©u th√¥ng tin App Store qua App ID ho·∫∑c Bundle ID</h2>
        <input type="text" id="appIdInput"
            placeholder="Nh·∫≠p App ID (vd: 123456789) ho·∫∑c Bundle ID (vd: com.example.app)" />
        <button onclick="lookupAppStore()">Tra c·ª©u</button>

        <div id="appLookupResult">K·∫øt qu·∫£ tra c·ª©u s·∫Ω hi·ªán ·ªü ƒë√¢y...</div>

        <div id="rawDataContainer" style="display:none;">
            <h3>Raw Data JSON</h3>
            <pre id="rawData">...</pre>
        </div>
    </div>

    <script>
        async function lookupAppStore() {
            const input = document.getElementById('appIdInput').value.trim();
            const output = document.getElementById('appLookupResult');
            const rawDataContainer = document.getElementById('rawDataContainer');
            const rawData = document.getElementById('rawData');

            rawDataContainer.style.display = 'none';
            rawData.textContent = '';

            if (!input) {
                output.textContent = 'Vui l√≤ng nh·∫≠p App ID ho·∫∑c Bundle ID.';
                return;
            }

            let cacheBust = Date.now();
            let url = '';
            if (/^\d+$/.test(input)) {
                url = `https://itunes.apple.com/lookup?id=${input}&cacheBust=${cacheBust}`;
            } else {
                url = `https://itunes.apple.com/lookup?bundleId=${encodeURIComponent(input)}&cacheBust=${cacheBust}`;
            }

            output.textContent = 'ƒêang t·∫£i d·ªØ li·ªáu...';

            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

                const data = await response.json();

                if (data.resultCount === 0) {
                    output.textContent = 'Kh√¥ng t√¨m th·∫•y app v·ªõi ID/Bundle ID n√†y.';
                    return;
                }

                const app = data.results[0];

                function createDescription(desc) {
                    const maxLen = 300;
                    if (desc.length <= maxLen) return `<p><strong>M√¥ t·∫£:</strong> ${desc}</p>`;

                    const shortDesc = desc.substring(0, maxLen);
                    const fullDesc = desc;

                    return `
                        <p><strong>M√¥ t·∫£:</strong> <span id="shortDesc">${shortDesc}...</span><span id="fullDesc" style="display:none;">${fullDesc}</span></p>
                        <span id="showMoreBtn">Xem th√™m</span>
                    `;
                }

                output.innerHTML = `
                    <p><strong>T√™n app:</strong> ${app.trackName}</p>
                    <p><strong>Phi√™n b·∫£n:</strong> ${app.version}</p>
                    <p><strong>Nh√† ph√°t tri·ªÉn:</strong> ${app.sellerName}</p>
                    ${createDescription(app.description)}
                    <p><strong>App Store URL:</strong> <a href="${app.trackViewUrl}" target="_blank" rel="noopener noreferrer">${app.trackViewUrl}</a></p>
                    <p><strong>Gi√°:</strong> ${app.formattedPrice || 'Mi·ªÖn ph√≠'}</p>
                    <p><strong>Ng√†y ph√°t h√†nh:</strong> ${app.releaseDate ? new Date(app.releaseDate).toLocaleDateString() : 'Kh√¥ng c√≥'}</p>
                    <p><strong>Th·ªÉ lo·∫°i:</strong> ${app.genres ? app.genres.join(', ') : 'Kh√¥ng c√≥'}</p>
                `;

                const showMoreBtn = document.getElementById('showMoreBtn');
                if (showMoreBtn) {
                    showMoreBtn.addEventListener('click', () => {
                        const shortDesc = document.getElementById('shortDesc');
                        const fullDesc = document.getElementById('fullDesc');
                        if (fullDesc.style.display === 'none') {
                            fullDesc.style.display = 'inline';
                            shortDesc.style.display = 'none';
                            showMoreBtn.textContent = 'Thu g·ªçn';
                        } else {
                            fullDesc.style.display = 'none';
                            shortDesc.style.display = 'inline';
                            showMoreBtn.textContent = 'Xem th√™m';
                        }
                    });
                }

                rawDataContainer.style.display = 'block';
                rawData.textContent = JSON.stringify(data, null, 2);

            } catch (error) {
                output.textContent = `L·ªói khi g·ªçi API: ${error.message}`;
                rawDataContainer.style.display = 'none';
                rawData.textContent = '';
            }
        }
    </script>

</body>

</html>